package smoother

import (
	"fmt"
	"testing"

	"github.com/lhhong/timeseries-query/pkg/repository"
)

var smoothTests = []repository.Values{
	{0, 3.6}, {1, 3.7}, {2, 3.8}, {3, 3.9}, {4, 3.9}, {5, 3.9}, {6, 4.0}, {7, 4.0}, {8, 4.0}, {9, 4.1}, {10, 4.2}, {11, 4.3}, {12, 4.5}, {13, 4.9}, {14, 4.8}, {15, 5.3}, {16, 5.8}, {17, 7.2}, {18, 8.1}, {19, 7.3}, {20, 5.7}, {21, 5.7}, {22, 5.6}, {23, 5.6}, {24, 5.5}, {25, 5.4}, {26, 5.3}, {27, 5.2}, {28, 6.0}, {29, 6.2}, {30, 6.3}, {31, 6.3}, {32, 6.4}, {34, 6.5}, {35, 6.6}, {36, 6.5}, {37, 6.4}, {38, 6.1}, {39, 5.7}, {40, 6.2}, {41, 6.3}, {42, 6.1}, {43, 6.5}, {44, 6.6}, {45, 6.8}, {46, 5.7}, {47, 5.2}, {48, 4.5}, {49, 4.1},
	{50, 3.6}, {51, 3.7}, {52, 3.8}, {53, 3.9}, {54, 3.9}, {55, 3.9}, {56, 4.0}, {57, 4.0}, {58, 4.0}, {59, 4.1}, {60, 4.2}, {61, 4.3}, {62, 4.5}, {63, 4.9}, {64, 4.8}, {65, 5.3}, {66, 5.8}, {67, 7.2}, {68, 8.1}, {69, 7.3}, {70, 5.7}, {71, 5.7}, {72, 5.6}, {73, 5.6}, {74, 5.5}, {75, 5.4}, {76, 5.3}, {77, 5.2}, {78, 6.0}, {79, 6.2}, {80, 6.3}, {81, 6.3}, {82, 6.4}, {84, 6.5}, {85, 6.6}, {86, 6.5}, {87, 6.4}, {88, 6.1}, {89, 5.7}, {90, 6.2}, {91, 6.3}, {92, 6.1}, {93, 6.5}, {94, 6.6}, {95, 6.8}, {96, 5.7}, {97, 5.2}, {98, 4.5}, {99, 4.1},
	{100, 3.6}, {101, 3.7}, {102, 3.8}, {103, 3.9}, {104, 3.9}, {105, 3.9}, {106, 4.0}, {107, 4.0}, {108, 4.0}, {109, 4.1}, {110, 4.2}, {111, 4.3}, {112, 4.5}, {113, 4.9}, {114, 4.8}, {115, 5.3}, {116, 5.8}, {117, 7.2}, {118, 8.1}, {119, 7.3}, {120, 5.7}, {121, 5.7}, {122, 5.6}, {123, 5.6}, {124, 5.5}, {125, 5.4}, {126, 5.3}, {127, 5.2}, {128, 6.0}, {129, 6.2}, {130, 6.3}, {131, 6.3}, {132, 6.4}, {134, 6.5}, {135, 6.6}, {136, 6.5}, {137, 6.4}, {138, 6.1}, {139, 5.7}, {140, 6.2}, {141, 6.3}, {142, 6.1}, {143, 6.5}, {144, 6.6}, {145, 6.8}, {146, 5.7}, {147, 5.2}, {148, 4.5}, {149, 4.1},
	{150, 3.6}, {151, 3.7}, {152, 3.8}, {153, 3.9}, {154, 3.9}, {155, 3.9}, {156, 4.0}, {157, 4.0}, {158, 4.0}, {159, 4.1}, {160, 4.2}, {161, 4.3}, {162, 4.5}, {163, 4.9}, {164, 4.8}, {165, 5.3}, {166, 5.8}, {167, 7.2}, {168, 8.1}, {169, 7.3}, {170, 5.7}, {171, 5.7}, {172, 5.6}, {173, 5.6}, {174, 5.5}, {175, 5.4}, {176, 5.3}, {177, 5.2}, {178, 6.0}, {179, 6.2}, {180, 6.3}, {181, 6.3}, {182, 6.4}, {184, 6.5}, {185, 6.6}, {186, 6.5}, {187, 6.4}, {188, 6.1}, {189, 5.7}, {190, 6.2}, {191, 6.3}, {192, 6.1}, {193, 6.5}, {194, 6.6}, {195, 6.8}, {196, 5.7}, {197, 5.2}, {198, 4.5}, {199, 4.1},
}

func TestSmooth(t *testing.T) {
	slice := make([]repository.Values, len(smoothTests))
	copy(slice, smoothTests)
	smooth(slice, 1, 1)
	for i, v := range slice {
		fmt.Printf("seq: %d, val: %f orig: %f\n", v.Seq, v.Value, smoothTests[i].Value)
	}
}

func TestSmoothData(t *testing.T) {
	res := SmoothData(smoothTests)
	for i, dat := range res {
		fmt.Printf("iter: %d\n", i)
		for _, v := range dat {
			fmt.Printf("%f ", v.Value)
		}
		fmt.Printf("\n")
	}
}

var signTests = []struct {
	name string
	val  float64
	out  int
}{
	{"negative", -5.123, -1},
	{"zero", 0.0, 0},
	{"positive", 0.1212, 1},
}

func TestSign(t *testing.T) {
	for _, tt := range signTests {
		t.Run(tt.name, func(t *testing.T) {
			res := sign(tt.val)
			if res != tt.out {
				t.Errorf("got %q, want %q", res, tt.out)
			}
		})
	}
}
